"use strict";(self.webpackChunkfinxapp=self.webpackChunkfinxapp||[]).push([[179],{51721:(e,s,t)=>{t.r(s),t.d(s,{default:()=>I});var l=t(65043),a=t(79904),o=t.n(a),n=(t(19980),t(8204)),r=t(24858),c=t(18403),d=t(73033),i=t(84756),h=t(47046),m=t(80511),u=(t(8387),t(53157)),g=t(20830),x=(t(7129),t(8318)),p=t(82585),v=t(70579);const S=p.F;const b=e=>{let s=[];return null===e||void 0===e||e.forEach((e=>{let{value:t,children:l}=e;s=[...s,t,...b(l)]})),s},f=d.Ik().shape({});let N=[];const I=function(){const[e,s]=(0,l.useState)([]),[t,a]=(0,l.useState)([]),[d,p]=(0,l.useState)(0),[I,j]=(0,l.useState)(""),[y,R]=(0,l.useState)(""),[w,B]=(0,l.useState)(!1),[k,M]=(0,l.useState)([]),[E,A]=(0,l.useState)([]);(0,l.useEffect)((()=>{(async()=>{const e=await(0,u.FV)();console.log("StageListResponse",e.body.scrstgs),M(e.body.scrstgs)})(),(async()=>{const e=await(0,g.r)();console.log("BranchListResponse",e.body.Branches),A(e.body.Branches)})()}),[]);const[F,O]=(0,l.useState)([]),C=async e=>{console.log(e);const s=await(0,u.vm)(e);console.log(s),O(s.body.SBRMap)},[J,L]=(0,l.useState)([]),[P,W]=(0,l.useState)([]);(0,l.useEffect)((()=>{}),[J]),0==N.length&&(N=(0,x.gB)(E),console.log(N)),(0,l.useEffect)((()=>{}),[t]);const{register:z,handleSubmit:G,formState:{errors:H},reset:T}=(0,r.mN)({resolver:(0,c.t)(f)}),[Y,$]=(0,l.useState)(""),U=async(e,l)=>{try{l.preventDefault(),console.log(e),console.log("Enter Save role ");let n={},r=[],c=S.UpdateStageRoleRights,d=[];t.forEach((e=>{let s,t,l={},a=e.split("-");2==a.length&&(s=a[0],t=a[1]);let o=r.findIndex((e=>e.BRMapId==s));console.log("objIndex ",o),-1!=o?r[o].Flag=r[o].Flag+t:(l={BRMapId:s,Flag:t},r.push(l))}));let h={StgId:I,Rights:r};d.push(h),n={SBRMap:d},console.log(JSON.stringify(n)),B(!0);const u=(0,m.lk)(),g={hdr:{convid:u,tag:"UpdateStageRoleRights",orgid:"",vendid:"0"},body:n},x={headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}};console.log(x);try{const e=await i.Ay.post(c,(0,m.Yw)(g),x),t=JSON.parse((0,m.H5)(e.data));console.log(t),"FAILED"==t.hdr.rst||"ERROR"==t.hdr.rst?(D("Error",JSON.stringify(t.fdr)),B(!1)):setTimeout((()=>{console.log(t.fdr),D("Success",JSON.stringify(t.fdr[0].rstmsg)),setTimeout((()=>{$({AlertType:"null",message:"null"})}),600),a([]),s([]),T({txtStageId:"",txtStagename:""}),C(I),B(!1)}),300)}catch(o){console.log(o.message),D("Error","Unable to process request"),B(!1)}}catch(n){D("Error",n.message),B(!1)}},D=(e,s)=>{$({AlertType:e,message:s})};try{var q,K;return(0,v.jsx)(v.Fragment,{children:(0,v.jsx)("section",{className:"vh-100",children:(0,v.jsx)("div",{className:"container h-100",children:(0,v.jsx)("div",{className:"row d-flex justify-content-center align-items-center h-100",children:(0,v.jsx)("div",{className:"col-lg-12 col-xl-11",children:(0,v.jsx)("div",{className:"card text-black",style:{borderRadius:"25px"},children:(0,v.jsxs)("div",{className:"card-body p-md-5",children:[(0,v.jsx)("div",{}),(0,v.jsx)("div",{className:"row justify-content-center",children:(0,v.jsxs)("div",{className:"row",children:[(0,v.jsx)("div",{className:"col-sm",children:(0,v.jsxs)("div",{className:"mb-3",children:[(0,v.jsx)("p",{className:"text-left h4 fw-bold mb-5 mx-1 mx-md-4 mt-4",children:"Manage Stage role rights"}),(0,v.jsx)("div",{className:"col-sm",children:(0,v.jsxs)("div",{className:"mb-3",children:[(0,v.jsx)("label",{htmlFor:"cmbScrId",className:"form-label",children:"Screen"}),(0,v.jsxs)("select",{...z("cmbScrId"),className:"form-control",onChange:e=>(e=>{if(""==e)return;const s=k.find((s=>s.ScrId==e));L(s.Stages),a([]),console.log(e),p(e),C(e)})(e.target.value),children:[(0,v.jsx)("option",{value:"0",children:"- Select -"}),k&&k.map((e=>(0,v.jsx)("option",{value:e.ScrId,children:e.ScrName},e.ScrId)))]}),(0,v.jsx)("p",{children:null===(q=H.cmbScrId)||void 0===q?void 0:q.message})]})}),(0,v.jsx)("div",{className:"col-sm",children:(0,v.jsxs)("div",{className:"mb-3",children:[(0,v.jsx)("label",{className:"form-label",children:" Stage List"}),(0,v.jsx)("select",{name:"list-box",size:20,className:"form-control",onChange:e=>(e=>{let t=[],l=[],o=[];console.log(J),j(e);let n=J.filter((s=>s.StgId==e));R(n[0].StgName),console.log(F);let r=F.filter((s=>s.StageId==e));console.log(r),void 0!=r?(t=r[0].Rights,t.forEach((e=>{let s=e.BRMapId,t=e.Flag;o.push(s),"WR"!=t&&"RW"!=t||(l.push(s+"-W"),l.push(s+"-R")),"W"==t&&l.push(s+"-W"),"R"==t&&l.push(s+"-R")})),o.push(l),console.log(l),console.log(o),s(b(N)),a(l)):a(l)})(e.target.value),children:J&&J.map((e=>(0,v.jsx)("option",{value:e.StgId,children:e.StgName},e.StgId)))})]})})]})}),(0,v.jsx)("div",{className:"col-sm",children:(0,v.jsxs)("div",{className:"mb-3",children:[(0,v.jsx)("p",{className:"text-center h4 fw-bold mb-5 mx-1 mx-md-4 mt-4",children:"Role"}),(0,v.jsx)("div",{children:w?(0,v.jsx)(h.A,{}):""}),(0,v.jsx)(n.A,{alert:Y}),(0,v.jsxs)("form",{onSubmit:G(U),autocomplete:"off",children:[(0,v.jsxs)("div",{className:"row",children:[(0,v.jsx)("div",{className:"col-sm",children:(0,v.jsxs)("div",{className:"mb-3",children:[(0,v.jsx)("input",{...z("txtStageId"),type:"text",className:"form-control",id:"txtStageId",disabled:!0,placeholder:"Stage Id",value:I}),(0,v.jsx)("p",{children:null===(K=H.txtStageId)||void 0===K?void 0:K.message})]})}),(0,v.jsx)("div",{className:"col-sm",children:(0,v.jsx)("div",{className:"mb-3",children:(0,v.jsx)("input",{...z("txtStagename"),type:"text",className:"form-control",id:"txtStagename",disabled:!0,placeholder:" Name",value:y})})})]}),(0,v.jsx)("div",{className:"row",children:(0,v.jsx)("div",{className:"col-sm",children:(0,v.jsx)("div",{className:"mb-3",children:(0,v.jsx)(o(),{nodes:N,checked:t,expanded:e,onCheck:e=>a(e),onExpand:e=>s(e)})})})}),(0,v.jsx)("button",{type:"submit",className:"btn btn-primary",children:"Submit"})]})]})})]})})]})})})})})})})}catch(V){console.log(V.message)}}},8318:(e,s,t)=>{t.d(s,{Rw:()=>a,gB:()=>o,vu:()=>l});t(65043);function l(e){let s,t,l,a={},o={},n=[],r=[],c="",d={},i={},h=[];return e.forEach((m=>{let u=[];if(h=m.MnuItm,null!=h){for(console.log("sourcearr",e),l=0;l<h.length;l+=1)d[h[l].MnuItmId]=l,c=h[l].MnuItmId+"-"+h[l].MnuGrpId+"-"+h[l].MnuItmName+"-"+h[l].Ord+"-"+h[l].ParentId+"-"+h[l].Link,o={value:c,label:h[l]},i={value:c,label:h[l].MnuItmName,showCheckbox:!1},u=[...u,i],null==h[l].ParentId&&(h[l].ParentId=0);for(l=0;l<h.length;l+=1)s=h[l],t=u[l],0!==s.ParentId?(null==u[d[s.ParentId]].children&&(u[d[s.ParentId]].children=[]),u[d[s.ParentId]].children.push(t)):r.push(t)}console.log("arr1item",m),c="0-"+m.MnuGrpId+"-"+m.MnuGrpName+"-"+m.Ord+"-"+m.Link,a={value:c,label:m.MnuGrpName,showCheckbox:!1,children:r},o={value:c,label:m},n=[...n,a],r=[]})),console.log("parent",n),n}function a(e){let s={},t={},l=[],a=[],o=[];return e.forEach((e=>{o=e.Roles,o.forEach((e=>{t={value:e.BRMapId,label:e.RName},a=[...a,t]})),s={value:e.BranchId+"-B",label:e.Name,showCheckbox:!1,children:a},l=[...l,s],a=[]})),l}function o(e){let s={},t={},l=[],a=[],o=[];return e.forEach((e=>{o=e.Roles,o.forEach((e=>{let s=[{value:e.BRMapId+"-R",label:"Read"},{value:e.BRMapId+"-W",label:"Write"}];t={value:e.BRMapId,label:e.RName,children:s},a=[...a,t]})),s={value:e.BranchId+"-B",label:e.Name,showCheckbox:!1,children:a},l=[...l,s],a=[]})),l}},8387:(e,s,t)=>{t.d(s,{m:()=>n});var l=t(80511),a=t(84756);const o=t(82585).F,n=async()=>{let e;const s=o.AllScreen,t={hdr:{convid:(0,l.lk)(),tag:"AllScreen",orgid:"",vendid:"0"},body:{}},n={headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}},r=s;return console.log(r),await a.Ay.post(r,(0,l.Yw)(t),n).then((function(s){const t=JSON.parse((0,l.H5)(s.data));e=t})),e}},7129:(e,s,t)=>{t.d(s,{K:()=>n});var l=t(80511),a=t(84756);const o=t(82585).F,n=async e=>{let s;const t=o.AllStage,n={hdr:{convid:(0,l.lk)(),tag:"AllStage",orgid:"",vendid:"0"},body:{txtScreenId:e}},r={headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}},c=t;return await a.Ay.post(c,(0,l.Yw)(n),r).then((function(e){const t=JSON.parse((0,l.H5)(e.data));s=t})),s}},20830:(e,s,t)=>{t.d(s,{r:()=>n});t(65043);var l=t(80511),a=t(84756),o=t(82585);const n=async()=>{let e;const s=o.F.BranchList,t={hdr:{convid:(0,l.lk)(),tag:"brchlst",orgid:"",vendid:"0"},body:{}},n={headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}},r=s;return await a.Ay.post(r,(0,l.Yw)(t),n).then((function(s){const t=JSON.parse((0,l.H5)(s.data));console.log(t),e=t})),e}}}]);
//# sourceMappingURL=179.a27516a6.chunk.js.map